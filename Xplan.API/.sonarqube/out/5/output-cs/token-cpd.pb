æ<
RC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Controllers\AccountController.cs
	namespace 	
Xplan
 
. 
API 
. 
Controllers 
{ 
public 

class 
AccountController "
:# $
BaseApiController% 6
{ 
private 
readonly 
ITokenService &
_tokenService' 4
;4 5
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
UserManager $
<$ %
AppUser% ,
>, -
_userManager. :
;: ;
private 
readonly 
SignInManager &
<& '
AppUser' .
>. /
_signInManager0 >
;> ?
public 
AccountController  
(  !
UserManager! ,
<, -
AppUser- 4
>4 5
userManager6 A
,A B
SignInManagerC P
<P Q
AppUserQ X
>X Y
signInManagerZ g
,g h
ITokenServicei v
tokenService	w É
,
É Ñ
IMapper
Ö å
mapper
ç ì
)
ì î
{ 	
_signInManager 
= 
signInManager *
;* +
_userManager 
= 
userManager &
;& '
_mapper 
= 
mapper 
; 
_tokenService 
= 
tokenService (
;( )
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[   	
HttpPost  	 
(   
$str   
)   
]   
public!! 
async!! 
Task!! 
<!! 
ActionResult!! &
<!!& '
UserDto!!' .
>!!. /
>!!/ 0
Register!!1 9
(!!9 :
RegisterDto!!: E
registerDto!!F Q
)!!Q R
{"" 	
if## 
(## 
await## 

UserExists##  
(##  !
registerDto##! ,
.##, -
Username##- 5
)##5 6
)##6 7
return##8 >

BadRequest##? I
(##I J
$str##J `
)##` a
;##a b
var%% 
user%% 
=%% 
_mapper%% 
.%% 
Map%% "
<%%" #
AppUser%%# *
>%%* +
(%%+ ,
registerDto%%, 7
)%%7 8
;%%8 9
user'' 
.'' 
UserName'' 
='' 
registerDto'' '
.''' (
Username''( 0
.''0 1
ToLower''1 8
(''8 9
)''9 :
;'': ;
var)) 
result)) 
=)) 
await)) 
_userManager)) +
.))+ ,
CreateAsync)), 7
())7 8
user))8 <
,))< =
registerDto))> I
.))I J
Password))J R
)))R S
;))S T
if++ 
(++ 
!++ 
result++ 
.++ 
	Succeeded++ !
)++! "
return++# )

BadRequest++* 4
(++4 5
result++5 ;
.++; <
Errors++< B
)++B C
;++C D
else,, 
{,, 
var-- 
confirmToken--  
=--! "
await--# (
_userManager--) 5
.--5 6/
#GenerateEmailConfirmationTokenAsync--6 Y
(--Y Z
user--Z ^
)--^ _
;--_ `
var.. 
confirmationLink.. $
=..% &
Url..' *
...* +
Action..+ 1
(..1 2
$str..2 @
,..@ A
$str..B K
,..K L
new// 
{// 
userId//  
=//! "
user//# '
.//' (
Id//( *
,//* +
token//, 1
=//2 3
confirmToken//4 @
}//A B
,//B C
Request//D K
.//K L
Scheme//L R
)//R S
;//S T
}00 
var22 

roleResult22 
=22 
await22 "
_userManager22# /
.22/ 0
AddToRoleAsync220 >
(22> ?
user22? C
,22C D
registerDto22E P
.22P Q
Role22Q U
)22U V
;22V W
if44 
(44 
!44 

roleResult44 
.44 
	Succeeded44 %
)44% &
return44' -

BadRequest44. 8
(448 9
result449 ?
.44? @
Errors44@ F
)44F G
;44G H
return66 
new66 
UserDto66 
{77 
Username88 
=88 
user88 
.88  
UserName88  (
,88( )
Token99 
=99 
await99 
_tokenService99 +
.99+ ,
CreateToken99, 7
(997 8
user998 <
)99< =
}:: 
;:: 
};; 	
[YY 	
HttpPostYY	 
(YY 
$strYY 
)YY 
]YY 
publicZZ 
asyncZZ 
TaskZZ 
<ZZ 
ActionResultZZ &
<ZZ& '
UserDtoZZ' .
>ZZ. /
>ZZ/ 0
LoginZZ1 6
(ZZ6 7
LoginDtoZZ7 ?
loginDtoZZ@ H
)ZZH I
{[[ 	
var\\ 
user\\ 
=\\ 
await\\ 
_userManager\\ )
.\\) *
Users\\* /
.\\/ 0 
SingleOrDefaultAsync\\0 D
(\\D E
x\\E F
=>\\G I
x\\J K
.\\K L
UserName\\L T
==\\U W
loginDto\\X `
.\\` a
Username\\a i
.\\i j
ToLower\\j q
(\\q r
)\\r s
)\\s t
;\\t u
if^^ 
(^^ 
user^^ 
==^^ 
null^^ 
)^^ 
return^^ $
Unauthorized^^% 1
(^^1 2
$str^^2 J
)^^J K
;^^K L
var`` 
result`` 
=`` 
await`` 
_signInManager`` -
.``- .$
CheckPasswordSignInAsync``. F
(``F G
user``G K
,``K L
loginDto``M U
.``U V
Password``V ^
,``^ _
false``` e
)``e f
;``f g
ifbb 
(bb 
!bb 
resultbb 
.bb 
	Succeededbb !
)bb! "
returnbb# )
Unauthorizedbb* 6
(bb6 7
)bb7 8
;bb8 9
returndd 
newdd 
UserDtodd 
{ee 
Usernameff 
=ff 
userff 
.ff  
UserNameff  (
,ff( )
Tokengg 
=gg 
awaitgg 
_tokenServicegg +
.gg+ ,
CreateTokengg, 7
(gg7 8
usergg8 <
)gg< =
}hh 
;hh 
}ii 	
privatekk 
asynckk 
Taskkk 
<kk 
boolkk 
>kk  

UserExistskk! +
(kk+ ,
stringkk, 2
usernamekk3 ;
)kk; <
{ll 	
returnmm 
awaitmm 
_userManagermm %
.mm% &
Usersmm& +
.mm+ ,
AnyAsyncmm, 4
(mm4 5
xmm5 6
=>mm7 9
xmm: ;
.mm; <
UserNamemm< D
==mmE G
usernamemmH P
.mmP Q
ToLowermmQ X
(mmX Y
)mmY Z
)mmZ [
;mm[ \
}nn 	
}oo 
}pp Ô
PC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Controllers\AdminController.cs
	namespace 	
Xplan
 
. 
API 
. 
Controllers 
{ 
public 

class 
AdminController  
:! "
BaseApiController# 4
{ 
private 
readonly 
UserManager $
<$ %
AppUser% ,
>, -
_userManager. :
;: ;
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IMapper  
_mapper! (
;( )
public 
AdminController 
( 
UserManager *
<* +
AppUser+ 2
>2 3
userManager4 ?
,? @
DataContextA L
contextM T
,T U
IMapperV ]
mapper^ d
)d e
{ 	
_userManager 
= 
userManager &
;& '
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
[ 	
	Authorize	 
( 
Policy 
= 
$str .
). /
]/ 0
[ 	
HttpGet	 
( 
$str #
)# $
]$ %
public 
ActionResult 
GetUsersWithRoles -
(- .
). /
{ 	
return 
Ok 
( 
$str &
)& '
;' (
}   	
[## 	
	Authorize##	 
(## 
Policy## 
=## 
$str## .
)##. /
]##/ 0
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
ActionResult%% &
>%%& '
GetInstallers%%( 5
(%%5 6
)%%6 7
{&& 	
var'' 
users'' 
='' 
await'' 
_userManager'' *
.''* +
GetUsersInRoleAsync''+ >
(''> ?
$str''? J
)''J K
;''K L
var)) 
installersToReturn)) "
=))# $
_mapper))% ,
.)), -
Map))- 0
<))0 1
IEnumerable))1 <
<))< =
InstallerDto))= I
>))I J
>))J K
())K L
users))L Q
)))Q R
;))R S
return++ 
Ok++ 
(++ 
installersToReturn++ (
)++( )
;++) *
},, 	
}99 
}:: á
RC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Controllers\BaseApiController.cs
	namespace 	
Xplan
 
. 
API 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
BaseApiController "
:# $
ControllerBase% 3
{ 
} 
}		 ˆ
PC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Controllers\UsersController.cs
	namespace 	
Xplan
 
. 
API 
. 
Controllers 
{ 
public 

class 
UsersController  
:! "
BaseApiController# 4
{ 
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UsersController 
( 
DataContext *
context+ 2
,2 3
IMapper4 ;
mapper< B
)B C
{ 	
_mapper 
= 
mapper 
; 
_context 
= 
context 
; 
} 	
[ 	
	Authorize	 
( 
Roles 
= 
$str "
)" #
]# $
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
InstallerDto3 ?
>? @
>@ A
>A B
GetUsersC K
(K L
)L M
{ 	
var 
users 
= 
await 
_context &
.& '
Users' ,
., -
ToListAsync- 8
(8 9
)9 :
;: ;
var   
installersToReturn   "
=  # $
_mapper  % ,
.  , -
Map  - 0
<  0 1
IEnumerable  1 <
<  < =
InstallerDto  = I
>  I J
>  J K
(  K L
users  L Q
)  Q R
;  R S
return"" 
Ok"" 
("" 
installersToReturn"" (
)""( )
;"") *
}## 	
['' 	
	Authorize''	 
('' 
Roles'' 
='' 
$str'' &
)''& '
]''' (
[(( 	
HttpGet((	 
((( 
$str(( 
)(( 
](( 
public)) 
async)) 
Task)) 
<)) 
ActionResult)) &
<))& '
InstallerDto))' 3
>))3 4
>))4 5
GetUser))6 =
())= >
int))> A
id))B D
)))D E
{** 	
var++ 
user++ 
=++ 
await++ 
_context++ %
.++% &
Users++& +
.+++ ,
	FindAsync++, 5
(++5 6
id++6 8
)++8 9
;++9 :
return-- 
_mapper-- 
.-- 
Map-- 
<-- 
InstallerDto-- +
>--+ ,
(--, -
user--- 1
)--1 2
;--2 3
}.. 	
[11 	
HttpPost11	 
]11 
public22 
void22 
Post22 
(22 
[22 
FromBody22 "
]22" #
string22$ *
value22+ 0
)220 1
{33 	
}44 	
[77 	
HttpPut77	 
(77 
$str77 
)77 
]77 
public88 
void88 
Put88 
(88 
int88 
id88 
,88 
[88  !
FromBody88! )
]88) *
string88+ 1
value882 7
)887 8
{99 	
}:: 	
[== 	

HttpDelete==	 
(== 
$str== 
)== 
]== 
public>> 
void>> 
Delete>> 
(>> 
int>> 
id>> !
)>>! "
{?? 	
}@@ 	
}AA 
}BB ô
EC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Data\DataContext.cs
	namespace 	
Xplan
 
. 
API 
. 
Data 
{ 
public 

class 
DataContext 
: 
IdentityDbContext 0
<0 1
AppUser1 8
,8 9
AppRole: A
,A B
intC F
,F G
IdentityUserClaim		 
<		 
int		 
>		 
,		 
AppUserRole		  +
,		+ ,
IdentityUserLogin		- >
<		> ?
int		? B
>		B C
,		C D
IdentityRoleClaim

 
<

 
int

 
>

 
,

 
IdentityUserToken

  1
<

1 2
int

2 5
>

5 6
>

6 7
{ 
public 
DataContext 
( 
DbContextOptions +
<+ ,
DataContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
{Q R
}R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
builder= D
)D E
{ 	
base 
. 
OnModelCreating  
(  !
builder! (
)( )
;) *
builder 
. 
Entity 
< 
AppUser "
>" #
(# $
)$ %
. 
HasMany 
( 
ur 
=> 
ur !
.! "
	UserRoles" +
)+ ,
. 
WithOne 
( 
u 
=> 
u 
.  
User  $
)$ %
. 
HasForeignKey 
( 
ur !
=>" $
ur% '
.' (
UserId( .
). /
. 

IsRequired 
( 
) 
; 
builder 
. 
Entity 
< 
AppRole "
>" #
(# $
)$ %
. 
HasMany 
( 
ur 
=> 
ur !
.! "
	UserRoles" +
)+ ,
. 
WithOne 
( 
u 
=> 
u 
.  
Role  $
)$ %
. 
HasForeignKey 
( 
ur !
=>" $
ur% '
.' (
RoleId( .
). /
. 

IsRequired 
( 
) 
; 
} 	
}"" 
}## ≠≥
gC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Data\Migrations\20210317111913_OpnieuwDoorIdentity.cs
	namespace 	
Xplan
 
. 
API 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
OpnieuwDoorIdentity ,
:- .
	Migration/ 8
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
	maxLength0 9
:9 :
$num; >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
	maxLength: C
:C D
$numE H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
nullable< D
:D E
trueF J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
	maxLength4 =
:= >
$num? B
,B C
nullableD L
:L M
trueN R
)R S
,S T
NormalizedUserName   &
=  ' (
table  ) .
.  . /
Column  / 5
<  5 6
string  6 <
>  < =
(  = >
	maxLength  > G
:  G H
$num  I L
,  L M
nullable  N V
:  V W
true  X \
)  \ ]
,  ] ^
Email!! 
=!! 
table!! !
.!!! "
Column!!" (
<!!( )
string!!) /
>!!/ 0
(!!0 1
	maxLength!!1 :
:!!: ;
$num!!< ?
,!!? @
nullable!!A I
:!!I J
true!!K O
)!!O P
,!!P Q
NormalizedEmail"" #
=""$ %
table""& +
.""+ ,
Column"", 2
<""2 3
string""3 9
>""9 :
("": ;
	maxLength""; D
:""D E
$num""F I
,""I J
nullable""K S
:""S T
true""U Y
)""Y Z
,""Z [
EmailConfirmed## "
=### $
table##% *
.##* +
Column##+ 1
<##1 2
bool##2 6
>##6 7
(##7 8
nullable##8 @
:##@ A
false##B G
)##G H
,##H I
PasswordHash$$  
=$$! "
table$$# (
.$$( )
Column$$) /
<$$/ 0
string$$0 6
>$$6 7
($$7 8
nullable$$8 @
:$$@ A
true$$B F
)$$F G
,$$G H
SecurityStamp%% !
=%%" #
table%%$ )
.%%) *
Column%%* 0
<%%0 1
string%%1 7
>%%7 8
(%%8 9
nullable%%9 A
:%%A B
true%%C G
)%%G H
,%%H I
ConcurrencyStamp&& $
=&&% &
table&&' ,
.&&, -
Column&&- 3
<&&3 4
string&&4 :
>&&: ;
(&&; <
nullable&&< D
:&&D E
true&&F J
)&&J K
,&&K L
PhoneNumber'' 
=''  !
table''" '
.''' (
Column''( .
<''. /
string''/ 5
>''5 6
(''6 7
nullable''7 ?
:''? @
true''A E
)''E F
,''F G 
PhoneNumberConfirmed(( (
=(() *
table((+ 0
.((0 1
Column((1 7
<((7 8
bool((8 <
>((< =
(((= >
nullable((> F
:((F G
false((H M
)((M N
,((N O
TwoFactorEnabled)) $
=))% &
table))' ,
.)), -
Column))- 3
<))3 4
bool))4 8
>))8 9
())9 :
nullable)): B
:))B C
false))D I
)))I J
,))J K

LockoutEnd** 
=**  
table**! &
.**& '
Column**' -
<**- .
DateTimeOffset**. <
>**< =
(**= >
nullable**> F
:**F G
true**H L
)**L M
,**M N
LockoutEnabled++ "
=++# $
table++% *
.++* +
Column+++ 1
<++1 2
bool++2 6
>++6 7
(++7 8
nullable++8 @
:++@ A
false++B G
)++G H
,++H I
AccessFailedCount,, %
=,,& '
table,,( -
.,,- .
Column,,. 4
<,,4 5
int,,5 8
>,,8 9
(,,9 :
nullable,,: B
:,,B C
false,,D I
),,I J
}-- 
,-- 
constraints.. 
:.. 
table.. "
=>..# %
{// 
table00 
.00 

PrimaryKey00 $
(00$ %
$str00% 5
,005 6
x007 8
=>009 ;
x00< =
.00= >
Id00> @
)00@ A
;00A B
}11 
)11 
;11 
migrationBuilder33 
.33 
CreateTable33 (
(33( )
name44 
:44 
$str44 (
,44( )
columns55 
:55 
table55 
=>55 !
new55" %
{66 
Id77 
=77 
table77 
.77 
Column77 %
<77% &
int77& )
>77) *
(77* +
nullable77+ 3
:773 4
false775 :
)77: ;
.88 

Annotation88 #
(88# $
$str88$ :
,88: ;
true88< @
)88@ A
,88A B
RoleId99 
=99 
table99 "
.99" #
Column99# )
<99) *
int99* -
>99- .
(99. /
nullable99/ 7
:997 8
false999 >
)99> ?
,99? @
	ClaimType:: 
=:: 
table::  %
.::% &
Column::& ,
<::, -
string::- 3
>::3 4
(::4 5
nullable::5 =
:::= >
true::? C
)::C D
,::D E

ClaimValue;; 
=;;  
table;;! &
.;;& '
Column;;' -
<;;- .
string;;. 4
>;;4 5
(;;5 6
nullable;;6 >
:;;> ?
true;;@ D
);;D E
}<< 
,<< 
constraints== 
:== 
table== "
=>==# %
{>> 
table?? 
.?? 

PrimaryKey?? $
(??$ %
$str??% :
,??: ;
x??< =
=>??> @
x??A B
.??B C
Id??C E
)??E F
;??F G
table@@ 
.@@ 

ForeignKey@@ $
(@@$ %
nameAA 
:AA 
$strAA F
,AAF G
columnBB 
:BB 
xBB  !
=>BB" $
xBB% &
.BB& '
RoleIdBB' -
,BB- .
principalTableCC &
:CC& '
$strCC( 5
,CC5 6
principalColumnDD '
:DD' (
$strDD) -
,DD- .
onDeleteEE  
:EE  !
ReferentialActionEE" 3
.EE3 4
CascadeEE4 ;
)EE; <
;EE< =
}FF 
)FF 
;FF 
migrationBuilderHH 
.HH 
CreateTableHH (
(HH( )
nameII 
:II 
$strII (
,II( )
columnsJJ 
:JJ 
tableJJ 
=>JJ !
newJJ" %
{KK 
IdLL 
=LL 
tableLL 
.LL 
ColumnLL %
<LL% &
intLL& )
>LL) *
(LL* +
nullableLL+ 3
:LL3 4
falseLL5 :
)LL: ;
.MM 

AnnotationMM #
(MM# $
$strMM$ :
,MM: ;
trueMM< @
)MM@ A
,MMA B
UserIdNN 
=NN 
tableNN "
.NN" #
ColumnNN# )
<NN) *
intNN* -
>NN- .
(NN. /
nullableNN/ 7
:NN7 8
falseNN9 >
)NN> ?
,NN? @
	ClaimTypeOO 
=OO 
tableOO  %
.OO% &
ColumnOO& ,
<OO, -
stringOO- 3
>OO3 4
(OO4 5
nullableOO5 =
:OO= >
trueOO? C
)OOC D
,OOD E

ClaimValuePP 
=PP  
tablePP! &
.PP& '
ColumnPP' -
<PP- .
stringPP. 4
>PP4 5
(PP5 6
nullablePP6 >
:PP> ?
truePP@ D
)PPD E
}QQ 
,QQ 
constraintsRR 
:RR 
tableRR "
=>RR# %
{SS 
tableTT 
.TT 

PrimaryKeyTT $
(TT$ %
$strTT% :
,TT: ;
xTT< =
=>TT> @
xTTA B
.TTB C
IdTTC E
)TTE F
;TTF G
tableUU 
.UU 

ForeignKeyUU $
(UU$ %
nameVV 
:VV 
$strVV F
,VVF G
columnWW 
:WW 
xWW  !
=>WW" $
xWW% &
.WW& '
UserIdWW' -
,WW- .
principalTableXX &
:XX& '
$strXX( 5
,XX5 6
principalColumnYY '
:YY' (
$strYY) -
,YY- .
onDeleteZZ  
:ZZ  !
ReferentialActionZZ" 3
.ZZ3 4
CascadeZZ4 ;
)ZZ; <
;ZZ< =
}[[ 
)[[ 
;[[ 
migrationBuilder]] 
.]] 
CreateTable]] (
(]]( )
name^^ 
:^^ 
$str^^ (
,^^( )
columns__ 
:__ 
table__ 
=>__ !
new__" %
{`` 
LoginProvideraa !
=aa" #
tableaa$ )
.aa) *
Columnaa* 0
<aa0 1
stringaa1 7
>aa7 8
(aa8 9
nullableaa9 A
:aaA B
falseaaC H
)aaH I
,aaI J
ProviderKeybb 
=bb  !
tablebb" '
.bb' (
Columnbb( .
<bb. /
stringbb/ 5
>bb5 6
(bb6 7
nullablebb7 ?
:bb? @
falsebbA F
)bbF G
,bbG H
ProviderDisplayNamecc '
=cc( )
tablecc* /
.cc/ 0
Columncc0 6
<cc6 7
stringcc7 =
>cc= >
(cc> ?
nullablecc? G
:ccG H
trueccI M
)ccM N
,ccN O
UserIddd 
=dd 
tabledd "
.dd" #
Columndd# )
<dd) *
intdd* -
>dd- .
(dd. /
nullabledd/ 7
:dd7 8
falsedd9 >
)dd> ?
}ee 
,ee 
constraintsff 
:ff 
tableff "
=>ff# %
{gg 
tablehh 
.hh 

PrimaryKeyhh $
(hh$ %
$strhh% :
,hh: ;
xhh< =
=>hh> @
newhhA D
{hhE F
xhhG H
.hhH I
LoginProviderhhI V
,hhV W
xhhX Y
.hhY Z
ProviderKeyhhZ e
}hhf g
)hhg h
;hhh i
tableii 
.ii 

ForeignKeyii $
(ii$ %
namejj 
:jj 
$strjj F
,jjF G
columnkk 
:kk 
xkk  !
=>kk" $
xkk% &
.kk& '
UserIdkk' -
,kk- .
principalTablell &
:ll& '
$strll( 5
,ll5 6
principalColumnmm '
:mm' (
$strmm) -
,mm- .
onDeletenn  
:nn  !
ReferentialActionnn" 3
.nn3 4
Cascadenn4 ;
)nn; <
;nn< =
}oo 
)oo 
;oo 
migrationBuilderqq 
.qq 
CreateTableqq (
(qq( )
namerr 
:rr 
$strrr '
,rr' (
columnsss 
:ss 
tabless 
=>ss !
newss" %
{tt 
UserIduu 
=uu 
tableuu "
.uu" #
Columnuu# )
<uu) *
intuu* -
>uu- .
(uu. /
nullableuu/ 7
:uu7 8
falseuu9 >
)uu> ?
,uu? @
RoleIdvv 
=vv 
tablevv "
.vv" #
Columnvv# )
<vv) *
intvv* -
>vv- .
(vv. /
nullablevv/ 7
:vv7 8
falsevv9 >
)vv> ?
}ww 
,ww 
constraintsxx 
:xx 
tablexx "
=>xx# %
{yy 
tablezz 
.zz 

PrimaryKeyzz $
(zz$ %
$strzz% 9
,zz9 :
xzz; <
=>zz= ?
newzz@ C
{zzD E
xzzF G
.zzG H
UserIdzzH N
,zzN O
xzzP Q
.zzQ R
RoleIdzzR X
}zzY Z
)zzZ [
;zz[ \
table{{ 
.{{ 

ForeignKey{{ $
({{$ %
name|| 
:|| 
$str|| E
,||E F
column}} 
:}} 
x}}  !
=>}}" $
x}}% &
.}}& '
RoleId}}' -
,}}- .
principalTable~~ &
:~~& '
$str~~( 5
,~~5 6
principalColumn '
:' (
$str) -
,- .
onDelete
ÄÄ  
:
ÄÄ  !
ReferentialAction
ÄÄ" 3
.
ÄÄ3 4
Cascade
ÄÄ4 ;
)
ÄÄ; <
;
ÄÄ< =
table
ÅÅ 
.
ÅÅ 

ForeignKey
ÅÅ $
(
ÅÅ$ %
name
ÇÇ 
:
ÇÇ 
$str
ÇÇ E
,
ÇÇE F
column
ÉÉ 
:
ÉÉ 
x
ÉÉ  !
=>
ÉÉ" $
x
ÉÉ% &
.
ÉÉ& '
UserId
ÉÉ' -
,
ÉÉ- .
principalTable
ÑÑ &
:
ÑÑ& '
$str
ÑÑ( 5
,
ÑÑ5 6
principalColumn
ÖÖ '
:
ÖÖ' (
$str
ÖÖ) -
,
ÖÖ- .
onDelete
ÜÜ  
:
ÜÜ  !
ReferentialAction
ÜÜ" 3
.
ÜÜ3 4
Cascade
ÜÜ4 ;
)
ÜÜ; <
;
ÜÜ< =
}
áá 
)
áá 
;
áá 
migrationBuilder
ââ 
.
ââ 
CreateTable
ââ (
(
ââ( )
name
ää 
:
ää 
$str
ää (
,
ää( )
columns
ãã 
:
ãã 
table
ãã 
=>
ãã !
new
ãã" %
{
åå 
UserId
çç 
=
çç 
table
çç "
.
çç" #
Column
çç# )
<
çç) *
int
çç* -
>
çç- .
(
çç. /
nullable
çç/ 7
:
çç7 8
false
çç9 >
)
çç> ?
,
çç? @
LoginProvider
éé !
=
éé" #
table
éé$ )
.
éé) *
Column
éé* 0
<
éé0 1
string
éé1 7
>
éé7 8
(
éé8 9
nullable
éé9 A
:
ééA B
false
ééC H
)
ééH I
,
ééI J
Name
èè 
=
èè 
table
èè  
.
èè  !
Column
èè! '
<
èè' (
string
èè( .
>
èè. /
(
èè/ 0
nullable
èè0 8
:
èè8 9
false
èè: ?
)
èè? @
,
èè@ A
Value
êê 
=
êê 
table
êê !
.
êê! "
Column
êê" (
<
êê( )
string
êê) /
>
êê/ 0
(
êê0 1
nullable
êê1 9
:
êê9 :
true
êê; ?
)
êê? @
}
ëë 
,
ëë 
constraints
íí 
:
íí 
table
íí "
=>
íí# %
{
ìì 
table
îî 
.
îî 

PrimaryKey
îî $
(
îî$ %
$str
îî% :
,
îî: ;
x
îî< =
=>
îî> @
new
îîA D
{
îîE F
x
îîG H
.
îîH I
UserId
îîI O
,
îîO P
x
îîQ R
.
îîR S
LoginProvider
îîS `
,
îî` a
x
îîb c
.
îîc d
Name
îîd h
}
îîi j
)
îîj k
;
îîk l
table
ïï 
.
ïï 

ForeignKey
ïï $
(
ïï$ %
name
ññ 
:
ññ 
$str
ññ F
,
ññF G
column
óó 
:
óó 
x
óó  !
=>
óó" $
x
óó% &
.
óó& '
UserId
óó' -
,
óó- .
principalTable
òò &
:
òò& '
$str
òò( 5
,
òò5 6
principalColumn
ôô '
:
ôô' (
$str
ôô) -
,
ôô- .
onDelete
öö  
:
öö  !
ReferentialAction
öö" 3
.
öö3 4
Cascade
öö4 ;
)
öö; <
;
öö< =
}
õõ 
)
õõ 
;
õõ 
migrationBuilder
ùù 
.
ùù 
CreateIndex
ùù (
(
ùù( )
name
ûû 
:
ûû 
$str
ûû 2
,
ûû2 3
table
üü 
:
üü 
$str
üü )
,
üü) *
column
†† 
:
†† 
$str
††  
)
††  !
;
††! "
migrationBuilder
¢¢ 
.
¢¢ 
CreateIndex
¢¢ (
(
¢¢( )
name
££ 
:
££ 
$str
££ %
,
££% &
table
§§ 
:
§§ 
$str
§§ $
,
§§$ %
column
•• 
:
•• 
$str
•• (
,
••( )
unique
¶¶ 
:
¶¶ 
true
¶¶ 
)
¶¶ 
;
¶¶ 
migrationBuilder
®® 
.
®® 
CreateIndex
®® (
(
®®( )
name
©© 
:
©© 
$str
©© 2
,
©©2 3
table
™™ 
:
™™ 
$str
™™ )
,
™™) *
column
´´ 
:
´´ 
$str
´´  
)
´´  !
;
´´! "
migrationBuilder
≠≠ 
.
≠≠ 
CreateIndex
≠≠ (
(
≠≠( )
name
ÆÆ 
:
ÆÆ 
$str
ÆÆ 2
,
ÆÆ2 3
table
ØØ 
:
ØØ 
$str
ØØ )
,
ØØ) *
column
∞∞ 
:
∞∞ 
$str
∞∞  
)
∞∞  !
;
∞∞! "
migrationBuilder
≤≤ 
.
≤≤ 
CreateIndex
≤≤ (
(
≤≤( )
name
≥≥ 
:
≥≥ 
$str
≥≥ 1
,
≥≥1 2
table
¥¥ 
:
¥¥ 
$str
¥¥ (
,
¥¥( )
column
µµ 
:
µµ 
$str
µµ  
)
µµ  !
;
µµ! "
migrationBuilder
∑∑ 
.
∑∑ 
CreateIndex
∑∑ (
(
∑∑( )
name
∏∏ 
:
∏∏ 
$str
∏∏ "
,
∏∏" #
table
ππ 
:
ππ 
$str
ππ $
,
ππ$ %
column
∫∫ 
:
∫∫ 
$str
∫∫ )
)
∫∫) *
;
∫∫* +
migrationBuilder
ºº 
.
ºº 
CreateIndex
ºº (
(
ºº( )
name
ΩΩ 
:
ΩΩ 
$str
ΩΩ %
,
ΩΩ% &
table
ææ 
:
ææ 
$str
ææ $
,
ææ$ %
column
øø 
:
øø 
$str
øø ,
,
øø, -
unique
¿¿ 
:
¿¿ 
true
¿¿ 
)
¿¿ 
;
¿¿ 
}
¡¡ 	
	protected
√√ 
override
√√ 
void
√√ 
Down
√√  $
(
√√$ %
MigrationBuilder
√√% 5
migrationBuilder
√√6 F
)
√√F G
{
ƒƒ 	
migrationBuilder
≈≈ 
.
≈≈ 
	DropTable
≈≈ &
(
≈≈& '
name
∆∆ 
:
∆∆ 
$str
∆∆ (
)
∆∆( )
;
∆∆) *
migrationBuilder
»» 
.
»» 
	DropTable
»» &
(
»»& '
name
…… 
:
…… 
$str
…… (
)
……( )
;
……) *
migrationBuilder
ÀÀ 
.
ÀÀ 
	DropTable
ÀÀ &
(
ÀÀ& '
name
ÃÃ 
:
ÃÃ 
$str
ÃÃ (
)
ÃÃ( )
;
ÃÃ) *
migrationBuilder
ŒŒ 
.
ŒŒ 
	DropTable
ŒŒ &
(
ŒŒ& '
name
œœ 
:
œœ 
$str
œœ '
)
œœ' (
;
œœ( )
migrationBuilder
—— 
.
—— 
	DropTable
—— &
(
——& '
name
““ 
:
““ 
$str
““ (
)
““( )
;
““) *
migrationBuilder
‘‘ 
.
‘‘ 
	DropTable
‘‘ &
(
‘‘& '
name
’’ 
:
’’ 
$str
’’ #
)
’’# $
;
’’$ %
migrationBuilder
◊◊ 
.
◊◊ 
	DropTable
◊◊ &
(
◊◊& '
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ #
)
ÿÿ# $
;
ÿÿ$ %
}
ŸŸ 	
}
⁄⁄ 
}€€ ƒ
gC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Data\Migrations\20210403121208_herstelVoorIdentity.cs
	namespace 	
Xplan
 
. 
API 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
herstelVoorIdentity ,
:- .
	Migration/ 8
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
}

 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} Ã
>C:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Data\Seed.cs
	namespace 	
Xplan
 
. 
API 
. 
Data 
{		 
public

 

class

 
Seed

 
{ 
public 
static 
async 
Task  
	SeedUsers! *
(* +
UserManager+ 6
<6 7
AppUser7 >
>> ?
userManager@ K
,K L
RoleManagerM X
<X Y
AppRoleY `
>` a
roleManagerb m
)m n
{ 	
if 
( 
await 
userManager !
.! "
Users" '
.' (
AnyAsync( 0
(0 1
)1 2
)2 3
return4 :
;: ;
var 
userData 
= 
await  
System! '
.' (
IO( *
.* +
File+ /
./ 0
ReadAllTextAsync0 @
(@ A
$strA Y
)Y Z
;Z [
var 
users 
= 
JsonSerializer &
.& '
Deserialize' 2
<2 3
List3 7
<7 8
AppUser8 ?
>? @
>@ A
(A B
userDataB J
)J K
;K L
if 
( 
users 
== 
null 
) 
return %
;% &
var 
roles 
= 
new 
List  
<  !
AppRole! (
>( )
{ 
new 
AppRole 
{ 
Name  
=! "
$str# *
}* +
,+ ,
new 
AppRole 
{ 
Name  
=! "
$str# .
}. /
,/ 0
new 
AppRole 
{ 
Name  
=! "
$str# -
}- .
} 
; 
foreach 
( 
var 
role 
in  
roles! &
)& '
{ 
await 
roleManager !
.! "
CreateAsync" -
(- .
role. 2
)2 3
;3 4
} 
foreach   
(   
var   
user   
in    
users  ! &
)  & '
{!! 
user"" 
."" 
UserName"" 
="" 
user""  $
.""$ %
UserName""% -
.""- .
ToLower"". 5
(""5 6
)""6 7
;""7 8
await## 
userManager## !
.##! "
CreateAsync##" -
(##- .
user##. 2
,##2 3
$str##4 >
)##> ?
;##? @
await$$ 
userManager$$ !
.$$! "
AddToRoleAsync$$" 0
($$0 1
user$$1 5
,$$5 6
$str$$7 B
)$$B C
;$$C D
}%% 
var'' 
admin'' 
='' 
new'' 
AppUser'' #
{(( 
UserName)) 
=)) 
$str)) "
}** 
;** 
await,, 
userManager,, 
.,, 
CreateAsync,, )
(,,) *
admin,,* /
,,,/ 0
$str,,1 ;
),,; <
;,,< =
await-- 
userManager-- 
.-- 
AddToRolesAsync-- -
(--- .
admin--. 3
,--3 4
new--5 8
[--8 9
]--9 :
{--; <
$str--< C
}--C D
)--D E
;--E F
}.. 	
}// 
}00 À
IC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\DTOs\InstallationDto.cs
	namespace 	
Xplan
 
. 
API 
. 
DTOs 
{ 
public 

class 
InstallationDto  
{ 
public 
int 

MyProperty 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ä

FC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\DTOs\InstallerDto.cs
	namespace 	
Xplan
 
. 
API 
. 
DTOs 
{ 
public 

class 
InstallerDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Logo		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
PhoneNumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
ICollection 
< 
InstallationDto *
>* +
Installations, 9
{: ;
get< ?
;? @
setA D
;D E
}F G
} 
} ⁄
BC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\DTOs\LoginDto.cs
	namespace 	
Xplan
 
. 
API 
. 
DTOs 
{ 
public 

class 
LoginDto 
{ 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
}		 î
EC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\DTOs\RegisterDto.cs
	namespace 	
Xplan
 
. 
API 
. 
DTOs 
{ 
public 

class 
RegisterDto 
{ 
[ 	
Required	 
] 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
[

 	
Required

	 
]

 
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ’
AC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\DTOs\UserDto.cs
	namespace 	
Xplan
 
. 
API 
. 
DTOs 
{ 
public 

class 
UserDto 
{ 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Token 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ä
\C:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Extensions\ApplicationServiceExtensions.cs
	namespace

 	
Xplan


 
.

 
API

 
.

 

Extensions

 
{ 
public 

static 
class (
ApplicationServiceExtensions 4
{ 
public 
static 
IServiceCollection ("
AddApplicationServices) ?
(? @
this@ D
IServiceCollectionE W
servicesX `
,` a
IConfigurationb p
configq w
)w x
{ 	
services 
. 
	AddScoped 
< 
ITokenService ,
,, -
TokenService. :
>: ;
(; <
)< =
;= >
services 
. 
AddAutoMapper "
(" #
typeof# )
() *
AutoMapperProfiles* <
)< =
.= >
Assembly> F
)F G
;G H
services 
. 
AddDbContext !
<! "
DataContext" -
>- .
(. /
x/ 0
=>1 3
x4 5
.5 6
	UseSqlite6 ?
(? @
config@ F
.F G
GetConnectionStringG Z
(Z [
$str[ n
)n o
)o p
)p q
;q r
return 
services 
; 
} 	
} 
} 
YC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Extensions\IdentityServiceExtensions.cs
	namespace

 	
Xplan


 
.

 
API

 
.

 

Extensions

 
{ 
public 

static 
class %
IdentityServiceExtensions 1
{ 
public 
static 
IServiceCollection (
AddIdentityServices) <
(< =
this= A
IServiceCollectionB T
servicesU ]
,] ^
IConfiguration_ m
confign t
)t u
{ 	
services 
. 
AddIdentityCore $
<$ %
AppUser% ,
>, -
(- .
opt. 1
=>2 4
{ 
opt 
. 
Password 
. "
RequireNonAlphanumeric 3
=4 5
false6 ;
;; <
} 
) 
. 
AddRoles 
< 
AppRole !
>! "
(" #
)# $
. 
AddRoleManager 
<  
RoleManager  +
<+ ,
AppRole, 3
>3 4
>4 5
(5 6
)6 7
. 
AddSignInManager !
<! "
SignInManager" /
</ 0
AppUser0 7
>7 8
>8 9
(9 :
): ;
. 
AddRoleValidator !
<! "
RoleValidator" /
</ 0
AppRole0 7
>7 8
>8 9
(9 :
): ;
. $
AddEntityFrameworkStores )
<) *
DataContext* 5
>5 6
(6 7
)7 8
;8 9
services 
. 
AddAuthentication &
(& '
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
)M N
.N O
AddJwtBearerO [
([ \
options\ c
=>d f
{g h
options 
. %
TokenValidationParameters 1
=2 3
new4 7%
TokenValidationParameters8 Q
{ $
ValidateIssuerSigningKey ,
=- .
true/ 3
,3 4
IssuerSigningKey $
=% &
new' * 
SymmetricSecurityKey+ ?
(? @
Encoding@ H
.H I
UTF8I M
.M N
GetBytesN V
(V W
configW ]
[] ^
$str^ h
]h i
)i j
)j k
,k l
ValidateIssuer "
=# $
false% *
,* +
ValidateAudience   $
=  % &
false  ' ,
,  , -
}!! 
;!! 
}"" 
)"" 
;"" 
services$$ 
.$$ 
AddAuthorization$$ %
($$% &
opt$$& )
=>$$* ,
{%% 
opt&& 
.&& 
	AddPolicy&& 
(&& 
$str&& 0
,&&0 1
policy&&2 8
=>&&9 ;
policy&&< B
.&&B C
RequireRole&&C N
(&&N O
$str&&O V
)&&V W
)&&W X
;&&X Y
}'' 
)'' 
;'' 
return)) 
services)) 
;)) 
}** 	
}++ 
},, è
OC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Helpers\AutoMapperProfiles.cs
	namespace 	
Xplan
 
. 
API 
. 
Helpers 
{ 
public 

class 
AutoMapperProfiles #
:$ %
Profile& -
{ 
public		 
AutoMapperProfiles		 !
(		! "
)		" #
{

 	
	CreateMap 
< 
AppUser 
, 
InstallerDto +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
RegisterDto !
,! "
AppUser# *
>* +
(+ ,
), -
;- .
} 	
} 
} Ì
MC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Interfaces\ITokenService.cs
	namespace 	
Xplan
 
. 
API 
. 

Interfaces 
{ 
public 

	interface 
ITokenService "
{ 
Task	 
< 
string 
> 
CreateToken !
(! "
AppUser" )
user* .
). /
;/ 0
}		 
}

 Ú
CC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\Address.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
Address 
{ 
public 
string 
Street 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Postcode 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
} 
}		 ’
CC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\AppRole.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
AppRole 
: 
IdentityRole '
<' (
int( +
>+ ,
{ 
public 
ICollection 
< 
AppUserRole &
>& '
	UserRoles( 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
}		 
}

 ’
CC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\AppUser.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
AppUser 
: 
IdentityUser '
<' (
int( +
>+ ,
{ 
public 
ICollection 
< 
AppUserRole &
>& '
	UserRoles( 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
} 
} ∫
GC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\AppUserRole.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
AppUserRole 
: 
IdentityUserRole /
</ 0
int0 3
>3 4
{ 
public 
AppUser 
User 
{ 
get !
;! "
set# &
;& '
}( )
public		 
AppRole		 
Role		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 
} Æ
HC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\Installation.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
Installation 
{ 
} 
} ®
EC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Models\Installer.cs
	namespace 	
Xplan
 
. 
API 
. 
Models 
{ 
public 

class 
	Installer 
{ 
} 
} Ø
<C:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Program.cs
	namespace 	
Xplan
 
. 
API 
{ 
public 

class 
Program 
{ 
public 
static 
async 
Task  
Main! %
(% &
string& ,
[, -
]- .
args/ 3
)3 4
{ 	
var 
host 
= 
CreateHostBuilder (
(( )
args) -
)- .
.. /
Build/ 4
(4 5
)5 6
;6 7
using 
var 
scope 
= 
host "
." #
Services# +
.+ ,
CreateScope, 7
(7 8
)8 9
;9 :
var 
services 
= 
scope  
.  !
ServiceProvider! 0
;0 1
try 
{ 
var 
context 
= 
services &
.& '
GetRequiredService' 9
<9 :
DataContext: E
>E F
(F G
)G H
;H I
var 
userManager 
=  !
services" *
.* +
GetRequiredService+ =
<= >
UserManager> I
<I J
AppUserJ Q
>Q R
>R S
(S T
)T U
;U V
var 
roleManager 
=  !
services" *
.* +
GetRequiredService+ =
<= >
RoleManager> I
<I J
AppRoleJ Q
>Q R
>R S
(S T
)T U
;U V
await 
context 
. 
Database &
.& '
MigrateAsync' 3
(3 4
)4 5
;5 6
await 
Seed 
. 
	SeedUsers $
($ %
userManager% 0
,0 1
roleManager2 =
)= >
;> ?
} 
catch   
(   
	Exception   
ex   
)    
{!! 
var"" 
logger"" 
="" 
services"" %
.""% &
GetRequiredService""& 8
<""8 9
ILogger""9 @
<""@ A
Program""A H
>""H I
>""I J
(""J K
)""K L
;""L M
logger## 
.## 
LogError## 
(##  
ex##  "
,##" #
$str##$ H
)##H I
;##I J
}$$ 
await&& 
host&& 
.&& 
RunAsync&& 
(&&  
)&&  !
;&&! "
}'' 	
public)) 
static)) 
IHostBuilder)) "
CreateHostBuilder))# 4
())4 5
string))5 ;
[)); <
]))< =
args))> B
)))B C
=>))D F
Host** 
.**  
CreateDefaultBuilder** %
(**% &
args**& *
)*** +
.++ $
ConfigureWebHostDefaults++ )
(++) *

webBuilder++* 4
=>++5 7
{,, 

webBuilder-- 
.-- 

UseStartup-- )
<--) *
Startup--* 1
>--1 2
(--2 3
)--3 4
;--4 5
}.. 
).. 
;.. 
};; 
}<< ˘
JC:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Services\TokenService.cs
	namespace 	
Xplan
 
. 
API 
. 
Services 
{ 
public 

class 
TokenService 
: 
ITokenService  -
{ 
private 
readonly  
SymmetricSecurityKey -
_key. 2
;2 3
private 
readonly 
UserManager $
<$ %
AppUser% ,
>, -
_userManager. :
;: ;
public 
TokenService 
( 
IConfiguration *
config+ 1
,1 2
UserManager3 >
<> ?
AppUser? F
>F G
userManagerH S
)S T
{ 	
_userManager 
= 
userManager &
;& '
_key 
= 
new  
SymmetricSecurityKey +
(+ ,
Encoding, 4
.4 5
UTF85 9
.9 :
GetBytes: B
(B C
configC I
[I J
$strJ T
]T U
)U V
)V W
;W X
} 	
public 
async 
Task 
< 
string  
>  !
CreateToken" -
(- .
AppUser. 5
user6 :
): ;
{ 	
var 
claims 
= 
new 
List !
<! "
Claim" '
>' (
{ 
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
NameId2 8
,8 9
user: >
.> ?
Id? A
.A B
ToStringB J
(J K
)K L
)L M
,M N
new   
Claim   
(   #
JwtRegisteredClaimNames   1
.  1 2

UniqueName  2 <
,  < =
user  > B
.  B C
UserName  C K
)  K L
}!! 
;!! 
var## 
roles## 
=## 
await## 
_userManager## *
.##* +
GetRolesAsync##+ 8
(##8 9
user##9 =
)##= >
;##> ?
claims%% 
.%% 
AddRange%% 
(%% 
roles%% !
.%%! "
Select%%" (
(%%( )
role%%) -
=>%%. 0
new%%1 4
Claim%%5 :
(%%: ;

ClaimTypes%%; E
.%%E F
Role%%F J
,%%J K
role%%L P
)%%P Q
)%%Q R
)%%R S
;%%S T
var'' 
creds'' 
='' 
new'' 
SigningCredentials'' .
(''. /
_key''/ 3
,''3 4
SecurityAlgorithms''5 G
.''G H
HmacSha512Signature''H [
)''[ \
;''\ ]
var)) 
tokenDescriptor)) 
=))  !
new))" %#
SecurityTokenDescriptor))& =
{** 
Subject++ 
=++ 
new++ 
ClaimsIdentity++ ,
(++, -
claims++- 3
)++3 4
,++4 5
Expires,, 
=,, 
DateTime,, "
.,," #
Now,,# &
.,,& '
AddDays,,' .
(,,. /
$num,,/ 0
),,0 1
,,,1 2
SigningCredentials-- "
=--# $
creds--% *
}.. 
;.. 
var00 
tokenHandler00 
=00 
new00 "#
JwtSecurityTokenHandler00# :
(00: ;
)00; <
;00< =
var22 
token22 
=22 
tokenHandler22 $
.22$ %
CreateToken22% 0
(220 1
tokenDescriptor221 @
)22@ A
;22A B
return44 
tokenHandler44 
.44  

WriteToken44  *
(44* +
token44+ 0
)440 1
;441 2
}55 	
}66 
}77 §
<C:\Users\xyyil\Documents\Projects\Xplan\Xplan.API\Startup.cs
	namespace 	
Xplan
 
. 
API 
{ 
public 

class 
Startup 
{ 
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 
Startup 
( 
IConfiguration %
config& ,
), -
{ 	
_config 
= 
config 
; 
} 	
public## 
void## 
ConfigureServices## %
(##% &
IServiceCollection##& 8
services##9 A
)##A B
{$$ 	
services%% 
.%% "
AddApplicationServices%% +
(%%+ ,
_config%%, 3
)%%3 4
;%%4 5
services&& 
.&& 
AddControllers&& #
(&&# $
)&&$ %
;&&% &
services'' 
.'' 
AddCors'' 
('' 
)'' 
;'' 
services(( 
.(( 
AddIdentityServices(( (
(((( )
_config(() 0
)((0 1
;((1 2
})) 	
public,, 
void,, 
	Configure,, 
(,, 
IApplicationBuilder,, 1
app,,2 5
,,,5 6
IWebHostEnvironment,,7 J
env,,K N
),,N O
{-- 	
if.. 
(.. 
env.. 
... 
IsDevelopment.. !
(..! "
).." #
)..# $
{// 
app00 
.00 %
UseDeveloperExceptionPage00 -
(00- .
)00. /
;00/ 0
}11 
app33 
.33 
UseHttpsRedirection33 #
(33# $
)33$ %
;33% &
app55 
.55 

UseRouting55 
(55 
)55 
;55 
app77 
.77 
UseCors77 
(77 
x77 
=>77 
x77 
.77 
AllowAnyHeader77 -
(77- .
)77. /
.77/ 0
AllowAnyMethod770 >
(77> ?
)77? @
.77@ A
WithOrigins77A L
(77L M
$str77M e
)77e f
)77f g
;77g h
app99 
.99 
UseAuthentication99 !
(99! "
)99" #
;99# $
app:: 
.:: 
UseAuthorization::  
(::  !
)::! "
;::" #
app<< 
.<< 
UseEndpoints<< 
(<< 
	endpoints<< &
=><<' )
{== 
	endpoints>> 
.>> 
MapControllers>> (
(>>( )
)>>) *
;>>* +
}?? 
)?? 
;?? 
}@@ 	
}AA 
}BB 